@{
  ViewData["Title"] = "Report";
}
@using System.Security.Claims
@using Microsoft.AspNetCore.Http
@model IEnumerable<Reports>

@section PageScripts {
  <script src="~/js/dashboards-analytics.js"></script>
  <script src="~/js/form-basic-inputs.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', function () {
      document.querySelectorAll('.edit-btn').forEach(function (btn) {
        btn.addEventListener('click', function () {
          document.getElementById('editId').value = this.dataset.id;
          document.getElementById('editVoiceCallCount').value = this.dataset.voice;
          document.getElementById('editVideoCallCount').value = this.dataset.video;
          document.getElementById('editAppliedJob').value = this.dataset.applied;
          document.getElementById('editMockInterviewCount').value = this.dataset.mock;
        });
      });
    });
  </script>
}

@* ************** Content ************** *@
@if (TempData["WRSaved"] != null)
{
  <script>
    alert("WRSaved");
  </script>
  TempData.Remove("WRSaved");
}
@if (TempData["Invalid"] != null)
{
  <script>
    alert("Invalid ModelState");
  </script>
  TempData.Remove("Invalid");
}

@if (TempData["DeleteSuccess"] != null)
{
  <script>
    alert("Report deleted successfully");
  </script>
  TempData.Remove("DeleteSuccess");
}
@if (TempData["NotFound"] != null)
{
  <script>
    alert("Report Delete Fail");
  </script>
  TempData.Remove("NotFound");
}

@if (TempData["EditSuccess"] != null)
{
  <script>
    alert("Report updated successfully");
  </script>
  TempData.Remove("EditSuccess");
}

@if (User.Identity?.IsAuthenticated ?? false)
{
  <p>Welcome, @User.Identity?.Name</p>
}


<!-- Modal -->
<form asp-controller="Report" asp-action="SaveWR" method="post">
  <div class="modal fade" id="modalCenter" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="modalCenterTitle">New Report</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <div class="row g-6">
            <div class="col mb-0">
              <label for="VoiceCall" class="form-label">VoiceCall</label>
              <input type="number" name="VoiceCallCount" class="form-control">
            </div>
            <div class="col mb-0">
              <label for="VideoCall" class="form-label">VideoCall</label>
              <input type="number" name="VideoCallCount" class="form-control">
            </div>
          </div>
          <div class="row g-6">
            <div class="col mb-0">
              <label for="AppliedJobCount" class="form-label">Applied Job Count</label>
              <input type="number" name="AppliedJobCount" class="form-control">
            </div>
            <div class="col mb-0">
              <label for="MockInterviewCount" class="form-label">Mock Interview Count</label>
              <input type="number" name="MockInterviewCount" class="form-control">
            </div>
          </div>
          <div>
            <input type="hidden" name="UserName" value="@User.Identity?.Name">
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">Close</button>
          <button type="submit" class="btn btn-primary">OK</button>
        </div>
      </div>
    </div>
  </div>
</form>

<form id="editForm" asp-controller="Report" asp-action="EditRow" method="post">
  <input type="hidden" id="editId" name="Id" />
  <input type="hidden" id="editUserName" name="UserName" value="@User.Identity?.Name" />
  <input type="hidden" id="editCreatedAt" name="CreatedAt" value="@DateTime.Now" />
  <div class="modal fade" id="editModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Edit Report</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <div class="row g-6">
            <div class="col mb-0">
              <label class="form-label">VoiceCall</label>
              <input type="number" id="editVoiceCallCount" name="VoiceCallCount" class="form-control">
            </div>
            <div class="col mb-0">
              <label class="form-label">VideoCall</label>
              <input type="number" id="editVideoCallCount" name="VideoCallCount" class="form-control">
            </div>
          </div>
          <div class="row g-6">
            <div class="col mb-0">
              <label class="form-label">Applied Job Count</label>
              <input type="number" id="editAppliedJob" name="AppliedJob" class="form-control">
            </div>
            <div class="col mb-0">
              <label class="form-label">Mock Interview Count</label>
              <input type="number" id="editMockInterviewCount" name="MockInterviewCount" class="form-control">
            </div>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">Close</button>
          <button type="submit" class="btn btn-primary">OK</button>
        </div>
      </div>
    </div>
  </div>
</form>


<div class="row">
  <div class="card">
    <h4 class="card-header">
      Report History
      <button type="button" class="btn btn-primary float-end" data-bs-toggle="modal" data-bs-target="#modalCenter">New
        Report</button>
    </h4>

    <div class="table-responsive text-nowrap">
      <table class="table">
        <thead>
          <tr>
            <th><i class="bx bx-phone text-default"></i>Date</th>
            <th><i class="bx bx-phone text-default"></i>Voice Call</th>
            <th><i class="bx bx-video text-default"></i>Video Call</th>
            <th><i class="bx bx-group text-default"></i>Mock Interview</th>
            <th><i class="bx bx-briefcase text-default"></i>Applied Job</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody class="table-border-bottom-0">
          @foreach (var record in Model)
          {
            <tr>
              <td>
                <span>@record.CreatedAt</span>
              </td>
              <td>
                <span>@record.VoiceCallCount</span>
              </td>
              <td>
                <span>@record.VideoCallCount</span>
              </td>
              <td>
                <span>@record.MockInterviewCount</span>
              </td>
              <td>
                <span>@record.AppliedJob</span>
              </td>
              <td>
                <div class="dropdown">
                  <button type="button" class="btn p-0 dropdown-toggle hide-arrow" data-bs-toggle="dropdown"><i
                      class="bx bx-dots-vertical-rounded"></i></button>
                  <div class="dropdown-menu">
                    <button class="dropdown-item edit-btn" data-id="@record.Id" data-voice="@record.VoiceCallCount"
                      data-video="@record.VideoCallCount" data-applied="@record.AppliedJob"
                      data-mock="@record.MockInterviewCount" data-bs-toggle="modal" data-bs-target="#editModal"><i
                        class="bx bx-edit-alt me-1"></i>
                      Edit</button>
                    <a type="submit" class="dropdown-item" asp-controller="Report" asp-action="DeleteRow"
                      asp-route-id="@record.Id"><i class="bx bx-trash me-1"></i>
                      Delete</a>
                  </div>
                </div>
              </td>
            </tr>
          }
        </tbody>
      </table>
    </div>
  </div>
  <!--/ Basic Bootstrap Table -->
</div>

<!--/ Basic Bootstrap Table -->
